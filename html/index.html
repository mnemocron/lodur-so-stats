<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
	<title>LODUR | simonmartin.ch</title>
	<style>
	html,
	body,
	#map {
		width: 100%;
		height: 100%;
		margin: 0;
		padding: 0;
	}
	</style>
	<link type="text/css" rel="stylesheet" href="./assets/jsmaps/v0.0.15/library/native/core.native.css" />
	<script src="./assets/jsmaps/v0.0.15/library/core.abstract.js" type="text/javascript"></script>
	<script src="./assets/jsmaps/v0.0.15/library/core.abstract-helper.js" type="text/javascript"></script>
	<script src="./assets/jsmaps/v0.0.15/library/core.js" type="text/javascript"></script>
	<script src="./assets/jsmaps/v0.0.15/library/native/core.native.js" type="text/javascript"></script>
	<script src="./assets/jsmaps/v0.0.15/library/native/core.native-ui.js" type="text/javascript"></script>
	<script src="./assets/jsmaps/v0.0.15/library/native/core.native-helper.js" type="text/javascript"></script>
	<script src="./assets/jsmaps/v0.0.15/library/native/core.native-marker.js" type="text/javascript"></script>
	<script src="./assets/jsmaps/v0.0.15/library/native/core.native-infoWindow.js" type="text/javascript"></script>
	<script src="./assets/jsmaps/v0.0.15/library/native/core.native-vector.js" type="text/javascript"></script>
</head>

<body>
	<script>
	var getJSON = function(url, callback) {
		var xhr = new XMLHttpRequest();
		xhr.open('GET', url, true);
		xhr.responseType = 'json';
		xhr.onload = function() {
			var status = xhr.status;
			if (status == 200) {
				callback(null, xhr.response);
			} else {
				callback(status);
			}
		};
		xhr.send();
	};

	/* I fucking hate this  - i just want to return the bloody json
	WTF? how does variable scope work? why is nothring sequential and just a fuckbunch of spaghetti code?? i hate this */
	function getJSONvar(url) {
		var xhr = new XMLHttpRequest();
		xhr.open('GET', url, true);
		xhr.responseType = 'json';
		var ret = null;
		xhr.onload = function() {
			var status = xhr.status;
			if (status == 200) {
				ret = xhr.response;
			} else {
				ret = null;
			}
		}
		xhr.send();
		return ret;
	}
	</script>
	<script type='text/javascript'>
	jsMaps.loader(function() {
		var tiles = new jsMaps.Native.Tiles();
		tiles.addTileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png", ['a', 'b', 'c'], '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>.', 'OpenStreetMap');
		tiles.addTileLayer("http://{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png", ['otile1', 'otile2', 'otile3', 'otile4'], '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>. Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="https://developer.mapquest.com/content/osm/mq_logo.png">', 'Map Quest');
		tiles.addTileLayer("http://{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg", ['oatile1', 'oatile2', 'oatile3', 'oatile4'], '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>. Tiles courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="https://developer.mapquest.com/content/osm/mq_logo.png">', 'Map Quest Satellite', 19);

		var map = jsMaps.api.init(
			'#map',
			'native', {
				center: {
					latitude: 47.1946,
					longitude: 7.5866
				},
				zoom: 14,
				mouse_scroll: true,
				zoom_control: true,
				map_type: true
			}, tiles
		);
		
		getJSON('./lodur-raw.json', function(err, rawlodur) {
			if (err != null) {
				console.error(err);
			} else {
				// console.log(rawlodur);
				var markers;
				var infoWindows;
				var index = 0;
				for(let i of rawlodur){
					var lat = parseFloat(i.lat);
					var lon = parseFloat(i.lon);
					if((lat != NaN) && (lon != NaN)){
						markers.push(
							jsMaps.api.marker(map, { position: { lat: lat, lng: lon }, title: 'Marker No x', draggable: false })
						);
						var contentStringX = '<div id="content">' +
											'<div id="siteNotice">' +
											'</div>' +
											'<div id="bodyContent"><p>' + (i.text) +
											'</p></div>' +
											'</div>';
						infoWindows.push(
							jsMaps.api.infoWindow({ content: contentStringX })
							);
						jsMaps.api.attach_event(markers[index], 'click', function() {
							infoWindows[index].open(map, markers[index]);
						});
						index = index +1;
					}
				}
			}
		});
	});
	</script>
	<div id='map'>
	</div>
</body>

</html>